// Copyright (c) 2021 Saleem Abdulrasool <compnerd@compnerd.org>
// SPDX-License-Identifier: BSD-3

import XCTest
@testable import WinMD

extension CodedIndex {
  fileprivate static var descriminatorBitWidth: Int {
    Self.mask.nonzeroBitCount
  }
}

final class StringsHeapTests: XCTestCase {
  static let heap: [UInt8] = [
      0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x31, 0x00, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x32, 0x00, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x33, 0x00, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x34, 0x00, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x35, 0x00, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x36, 0x00, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x37, 0x00, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x38, 0x00, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x39, 0x00, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x31, 0x30, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x31, 0x31, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x31, 0x32, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x31, 0x33, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x31, 0x34, 0x00,
      0x53, 0x74, 0x72, 0x69, 0x6e, 0x67, 0x20, 0x31, 0x35, 0x00,
  ]

  func testSubscript() {
    let heap = StringsHeap(data: StringsHeapTests.heap[...])

    XCTAssertEqual(heap[0], "")
    for string in (1 ... 15) {
      XCTAssertEqual(heap[1 + (string - 1) * 10], "String \(string)")
    }
  }
}
